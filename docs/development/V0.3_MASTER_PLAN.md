# Harthio v0.3 - Master Implementation Plan

**Version:** v0.3 - AI Companion + Mental Health Focus  
**Current:** v0.2 (40 users)  
**Timeline:** Q1 2025 (12 weeks)  
**Target:** 500 users, 10% Pro conversion  
**Status:** Week 3-4 (UI Redesign Phase)

---

## ğŸ†• Recent Updates (Latest Session)

### **UI/UX Polish & Consistency** ğŸ¨ (NEW - Week 9)
- âœ… **Mobile Navigation Enhancements**
  - Fixed input bar scrolling on mobile (Harthio chat page)
  - Mobile header fixed positioning (doesn't scroll with content)
  - Input bar positioned above mobile nav (bottom-16)
  - Auto-expanding textarea (1-5 lines) with hidden scrollbar
  - Nav bar icons made bolder (strokeWidth 2.5)
  - Tablet view: icons only, no labels (sm:hidden on text)
  
- âœ… **Avatar System Overhaul**
  - LinkedIn-style default avatar (User icon in teal)
  - Consistent across all pages (profile, sessions, notifications, sidebar)
  - White background with thin border
  - Removed 40x40 placeholder images
  - All avatars use same design pattern
  
- âœ… **Profile Pages Redesign (X/Twitter Style)**
  - No banner/cover image (cleaner)
  - Avatar and Edit button at top
  - Profile info flows naturally below
  - Full-width sections with borders
  - Consistent bg-background color scheme
  - One-button photo upload (choose + upload combined)
  
- âœ… **Session Cards Improvements**
  - Removed star ratings from cards (visible in public profile)
  - Better timestamp format:
    - < 1 min: "now"
    - < 1 hour: "7m"
    - < 24 hours: "7h"
    - < 1 year: "15 NOV"
    - > 1 year: "May 15, 2024"
  - Exact duration display: "1 hour 21 minutes" (not "about 1 hour")
  - Mobile-friendly time format (compact)
  - Shortened pending requests text: "1 pending request â€¢ View"
  - Fixed title text wrapping (break-words)
  
- âœ… **Button Consistency**
  - All buttons: rounded-full, font-semibold, h-11
  - Schedule session button matches app style
  - Request to Join, Share, Upcoming Session - all consistent
  - Add Tracker button: centered, reasonable size
  
- âœ… **Navigation & Flow Improvements**
  - Session end redirects to /harthio (for post-session support)
  - Notification badge auto-refreshes on desktop (pathname change)
  - Ongoing session indicator only on /sessions page
  - X icon on notifications page (acts as back button)
  - Greeting restored on mobile home page
  - Daily quote moved to bottom of home page
  - Check-in heading always: "How are you feeling today?"

### **Unified Mobile Header System** ğŸ“± (Week 8)
- âœ… **Logo-Only Header Design** - Clean, uncluttered approach
  - Left: Harthio logo + BETA badge
  - Right: Notifications bell icon with badge count
  - Center: Empty (spacious, professional)
  - No page titles (users know from bottom nav + content)
- âœ… **Consistent Across All Pages** - Same header on Home, Harthio, Sessions, Progress, Me
- âœ… **Sessions Page Enhancement** - Search bar moved below header (not in header)
- âœ… **Renamed "Requests" â†’ "Notifications"** - More scalable, user-friendly
- âœ… **Unified Notification Feed** - Single feed (no tabs), all notification types mixed:
  - Session requests (incoming/outgoing)
  - AI alerts (pattern detection, reminders)
  - Milestones (tracker achievements)
  - Request status updates (approved/declined)
  - System announcements
- âœ… **Notification Properties** - Icon, title, timestamp, action buttons, read/unread indicator
- âœ… **Smart Badge Count** - Shows total unread notifications across all types

### **Mobile UX Improvements** ğŸ“±
- âœ… Mobile page header component created and implemented
- âœ… Logo component optimized (smaller text, compact BETA badge)
- âœ… Icon sizes increased for better touch targets (h-5 w-5)
- âœ… Text sizes standardized to Twitter/X standards:
  - Session titles: 17px (readable, clear hierarchy)
  - Body text: 15px (comfortable reading)
  - Metadata: 13px (compact but readable)
- âœ… "My Upcoming Sessions" renamed to "My Sessions" (cleaner)
- âœ… Search sheet simplified (removed filters, matches desktop)
- âœ… Requests sheet redesigned (cleaner, modern cards)
- âœ… Responsive design fixes - proper padding, spacing, bottom nav clearance

### **Database Fixes** ğŸ”§
- âœ… Fixed `filteredSessions` initialization bug (variable hoisting)
- âœ… Created `fix-topics-and-rpc.sql` migration:
  - Adds missing `updated_at` column to topics table
  - Creates `add_join_request_secure` function (what code calls)
  - Adds security validations (auth check, input validation, message length limit)
  - Idempotent (safe to run multiple times)
- âœ… Created `PRODUCTION_MIGRATIONS.md` - documents only 5 required migrations
- âš ï¸ Identified 20+ unused database files (need cleanup/archiving)

### **Discovered Issues** ğŸ›
- âŒ Database has many legacy/unused files (security-fixes, experimental features)
- âŒ Some files duplicate functionality already in combined.sql
- ğŸ“ Recommendation: Archive unused files to keep database/ folder clean

---

## ğŸ¯ Current Progress Summary

**âœ… COMPLETED (Week 1-6):**

### **Core Infrastructure**
- 5-tab navigation system (mobile + desktop)
- Database migrations with RLS security (daily_checkins, sobriety_trackers)
- Security hardening (all APIs with rate limiting, validation, OWASP compliance)
- Contact API secured
- Webpack cache management

### **Progress Page** ğŸ“Š
- 3 tabs: Tracker | History | Stats
- 7-day mood trend line chart (shows gaps, not punishing)
- Weekly insights (average mood, trend %, best/worst days)
- Weekly stats with achievement badges
- Session history integration
- Real data integration

### **Home Page Redesign** ğŸ  (Recovery-Focused)
- **Real-time sobriety counter**
  - Counts: Months, Days, Hours, Minutes, Seconds
  - Updates every second
  - Multiple tracker support (alcohol, smoking, drugs, gambling, other)
  - Swipeable cards with dots indicator
  - Milestone badges (âœ¨1 Day, ğŸŒŸ1 Week, ğŸ‰1 Month, ğŸ†90 Days, ğŸ‘‘1 Year)
  - Color-coded by type
  - Background visuals (Bridge/Phoenix/Mountain) - coming
  
- **Mood check-in** (kept simple)
  - 4 mood buttons (ğŸ˜¢ Struggling, ğŸ˜ Okay, ğŸ˜Š Good, ğŸš€ Great)
  - Last check-in indicator
  
- **Simplified motivational quotes**
  - 5 short, impactful quotes (down from 31 long ones)
  - Small, non-intrusive display
  
- **Intentionally Removed:**
  - âŒ Check-in streaks (too stressful, punishes missed days)
  - âŒ Sessions joined stat (belongs in Progress)
  - âŒ Manual tracker creation button (AI will handle)
  - âŒ Reset button (AI-guarded for safety)
  - âŒ Quick action buttons (reduces clutter)

**âœ… COMPLETED (Week 7):**
- **Contextual Check-in with Slide-down Input** ğŸ¯
  - Smart prompts based on mood selected (4 different prompts)
  - Optional note capture for context
  - Slide-down animation from top
  - Skip or save options
  - Builds data for AI pattern detection

**âœ… COMPLETED (Week 7):**
- **Unified Chat System** ğŸ’¬ (MAJOR ENHANCEMENT)
  - Single `ModernChatPanel` component for all chat needs
  - Supports two modes: `peer` (user-to-user) and `ai` (AI chat)
  - **Brand-Aligned Design:**
    - Uses Harthio logo for AI avatar (with pulse animation when thinking)
    - Warm Rose (primary) and Gentle Teal (accent) colors only
    - Soft Lavender backgrounds
    - No purple/pink gradients - pure brand colors
  - **Mobile-First Responsive:**
    - Mobile (< 768px): Full-screen bottom sheet, 85vh height
    - Tablet (768-1024px): 400px side panel
    - Desktop (> 1024px): 500px side panel
    - Larger touch targets (44px minimum)
    - Safe area insets for notched devices
    - Prevents zoom on iOS input focus
  - **Accessibility:**
    - Proper ARIA labels
    - Keyboard navigation (Enter to send)
    - Screen reader support
    - High contrast ratios
  - Used in both Session page and Harthio AI page
  - Consistent UX across the platform

- **Harthio AI Chat Interface** ğŸ’¬ (CORE v0.3 feature)
  - DeepSeek API integration
  - Conversational AI for 24/7 support
  - Crisis keyword detection with immediate resources
  - System prompt optimized for mental health support
  - Chat history with user/assistant messages
  - Real-time typing and responses
  - Mobile-responsive design
  - Uses unified ModernChatPanel component
  - Pro-tier ready (auth TODO documented)

- **AI-Guarded Tracker Reset** ğŸ†˜
  - Redirects to Harthio AI when reset clicked
  - Special conversation flow for relapse support
  - Crisis intervention at critical moment
  - Prevents impulsive decisions
  - Offers support before allowing reset
  - Reset button appears after conversation
  - Compassionate messaging (no judgment)

- **Contextual Check-in with Slide-down Input** ğŸ¯
  - Smart prompts based on mood selected (4 different prompts)
  - Optional note capture for context
  - Slide-down animation from top
  - Skip or save options
  - Builds data for AI pattern detection

**âœ… COMPLETED (Week 7 continued):**
- **AI-Powered Tracker Creation** ğŸ¤–
  - Conversational tracker setup via Harthio AI
  - Natural language processing for tracker type detection
  - Automatic start date extraction ("3 days ago", "yesterday", etc.)
  - Confirmation button before creation
  - Redirects from Home page "Add Tracker" button
  - Supports: alcohol, smoking, drugs, gambling, other
  - Smart intent detection with confidence scoring

**ğŸš§ IN PROGRESS (Week 7-8):**

**âœ… COMPLETED (Week 7 continued):**
- **Pattern Detection & Proactive Support** ğŸ”
  - Detects 3+ consecutive days of "struggling" check-ins
  - Automatic intervention toast notification
  - Redirects to Harthio AI with compassionate message
  - Special intervention conversation flow
  - Non-intrusive but supportive approach
  - Helps users before crisis escalates

**âœ… COMPLETED (Week 7 continued):**
- **CBT Tools Suite** ğŸ§  (World-Class Clinical Standard)
  - **Evidence-Based Techniques:**
    - Thought Challenger (Aaron Beck's CBT - Grade A evidence)
    - 4-4-6 Breathing (Neuroscience validated - Grade A)
    - 5-4-3-2-1 Grounding (DBT standard - Grade B)
    - Coping Techniques (Multiple validated interventions)
  - **Clinical Sequencing:** Validate â†’ Normalize â†’ Educate â†’ Offer â†’ Guide â†’ Check-in â†’ Escalate
  - **Smart Detection** - Keywords for anxiety, negative thoughts, cravings, stress
  - **Professional Disclaimers** - One-time notice, positively framed, non-intrusive
  - **Crisis Escalation** - Clear path to professional help if techniques don't work
  - **Industry Comparison** - Matches Headspace/Calm standards at lower price
  - **Full Documentation** - Clinical references, evidence levels, research support
  - **Pro Access Only** - Part of Harthio AI ($9.99/month vs $70+/year competitors)

**âœ… COMPLETED (Week 7 - ALL FEATURES DONE!):**
- **Visual Recovery Journey** ğŸŒ‰ (Gamification System)
  - **30-Piece System:** 1 piece unlocks every 3 days
  - **3-Phase Journey:** Bridge (0-90d) â†’ Phoenix (91-180d) â†’ Mountain (181-365d)
  - **Compassionate Relapse:** Tiered loss system (lose 0-3 pieces based on progress)
  - **Progress Tracking:** Previous best, total attempts, resilience score
  - **Comeback Badges:** Reward persistence and recovery
  - **Database:** Visual journey fields + relapse history table
  - **Service Functions:** Calculate pieces, relapse impact, next milestone

**ğŸš§ IN PROGRESS (Week 7-8):**

**â³ NEXT UP (Priority Order):**

1. **AI Feedback System (ğŸ‘ğŸ‘)** - HIGH PRIORITY â­
   - Thumbs up/down on every AI message
   - Log feedback to database
   - Critical for AI training and safety
   - **Time: 3-4 hours**
   - **Why urgent:** AI is live, need feedback NOW to improve quality

2. **AI Tracker Creation Flow Fix** - HIGH PRIORITY
   - Fix broken tracker creation from natural conversation
   - **Time: 2-3 hours**

3. Pro tier subscription system (Stripe integration)
4. Rate limiting for AI usage (free vs pro)
5. Background images for visual journey (Bridge/Phoenix/Mountain photos)

---

## ğŸ¯ AI Feedback System (ğŸ‘ğŸ‘) - HIGH PRIORITY

**Why This Is Critical:**
- AI is live with users RIGHT NOW
- Need feedback to improve quality
- Safety-critical for mental health support
- Early data shapes entire AI experience
- Catch problems before they spread

**What It Does:**

**ğŸ‘ Thumbs Up:**
- User likes the response
- Log as positive feedback
- Show: "Glad I could help! ğŸ’™"
- Track satisfaction rate

**ğŸ‘ Thumbs Down:**
- User didn't like response
- Show feedback form:
  ```
  What went wrong?
  â˜ Not helpful
  â˜ Incorrect information
  â˜ Misunderstood me
  â˜ Inappropriate
  â˜ Other: [text input]
  ```
- Log detailed feedback
- AI responds: "I'm sorry. Let me try again..."
- Flag for human review

**Database Schema:**
```sql
CREATE TABLE ai_feedback (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  message_id TEXT NOT NULL,
  message_content TEXT NOT NULL,
  ai_response TEXT NOT NULL,
  feedback_type TEXT CHECK (feedback_type IN ('positive', 'negative')),
  reason TEXT, -- For negative: 'not_helpful', 'incorrect', 'misunderstood', 'inappropriate', 'other'
  reason_details TEXT, -- Free text explanation
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_ai_feedback_user ON ai_feedback(user_id);
CREATE INDEX idx_ai_feedback_type ON ai_feedback(feedback_type);
CREATE INDEX idx_ai_feedback_date ON ai_feedback(created_at DESC);
```

**UI Implementation:**
```tsx
// On every AI message
<div className="flex items-center gap-2 mt-2">
  <button 
    onClick={() => handleFeedback('positive')}
    className="text-gray-400 hover:text-green-600"
  >
    ğŸ‘
  </button>
  <button 
    onClick={() => handleFeedback('negative')}
    className="text-gray-400 hover:text-red-600"
  >
    ğŸ‘
  </button>
</div>
```

**Files to Create:**
- `database/migrations/add-ai-feedback.sql` - Database schema
- `src/lib/services/ai-feedback-service.ts` - Feedback CRUD operations

**Files to Modify:**
- `src/components/harthio/modern-chat-panel.tsx` - Add thumbs up/down buttons
- `src/app/(authenticated)/harthio/page.tsx` - Handle feedback submission

**Implementation Steps:**
1. Create database migration (30 min)
2. Create feedback service (1 hour)
3. Add UI buttons to chat (1 hour)
4. Add feedback form for thumbs down (1 hour)
5. Testing (30 min)

**Total Time:** 3-4 hours

**Benefits:**
- âœ… Improve AI quality continuously
- âœ… Catch harmful responses
- âœ… Measure user satisfaction
- âœ… Build trust (users feel heard)
- âœ… Data for future AI training

**Admin Dashboard (v0.4):**
- View all feedback
- Filter by type (positive/negative)
- See patterns in complaints
- Export for analysis

---

## ğŸ› BUG FIX NEEDED: AI Tracker Creation Flow

**Problem:** AI can detect tracker intent but doesn't complete the creation flow. User says "I want to quit smoking" â†’ AI talks about it but never actually creates the tracker.

**Current Flow (Broken):**
```
User: "I want to quit smoking"
AI: Detects intent, talks about tracking
â†’ No tracker created âŒ
```

**What Should Happen:**
```
User: "I want to quit smoking"
AI: "That's amazing! Would you like me to set up a tracker 
     to count your smoke-free days?"
     
User: "Yes"

AI: "Great! When did you start?"
[Shows: Today | Yesterday | Pick Date buttons]

User: Selects date

AI: "Choose your visual journey:"
[Shows: Bridge | Phoenix | Mountain images]

User: Selects image

â†’ Tracker created! âœ…
```

**Solution Options:**

**Option A: Natural Language Detection (Recommended for v0.3)**
- AI detects phrases like "I want to quit", "I want to track", "help me stop"
- AI explicitly asks: "Would you like me to create a tracker for this?"
- If yes â†’ Show image selection UI
- Complete the flow

**Option B: Interactive Components (Better - v0.4)**
- Show button groups for choices
- Calendar picker for dates
- Image selection buttons
- Faster, clearer, no ambiguity

**Implementation for v0.3:**
1. Improve AI prompt to explicitly offer tracker creation
2. Add confirmation step: "Would you like me to create this tracker?"
3. Trigger `setShowImageSelection(true)` when user confirms
4. Complete existing flow (image selection â†’ create)

**Files to Modify:**
- `src/app/(authenticated)/harthio/page.tsx` - Add confirmation detection
- `src/lib/ai-service.ts` - Update system prompt with tracker creation flow

**Estimated Time:** 2-3 hours

**Priority:** High - Core feature is broken

**ğŸ“ TODO: AI API Authentication (Before Production)**
Location: `src/app/api/ai/chat/route.ts`

Currently has NO authentication for development. Before production:
1. Add authentication check (verify Supabase token)
2. Add Pro tier check (only Pro users can access AI)
3. Add rate limiting (prevent abuse)
4. Update client to send auth token in headers

See current code comments in the file for implementation details.

---

## ğŸ“‹ Table of Contents
1. [Vision & Strategy](#vision--strategy)
2. [Feature Specifications](#feature-specifications)
3. [Pricing Model](#pricing-model)
4. [Mobile-First Design](#mobile-first-design)
5. [Crisis Detection System](#crisis-detection-system)
6. [Implementation Timeline](#implementation-timeline)
7. [Success Metrics](#success-metrics)

---

## Vision & Strategy

### **Three-Tier Growth Model**
```
Tier 1: AI Companion (v0.3) â† Building Now
â”œâ”€ 24/7 AI support
â”œâ”€ CBT tools
â””â”€ Recovery tracking

Tier 2: Peer Sessions (Live) âœ…
â”œâ”€ Video/voice calls
â”œâ”€ Community support
â””â”€ 40 active users

Tier 3: Professional Therapy (v0.4) ğŸ”®
â”œâ”€ Licensed therapists
â”œâ”€ Insurance integration
â””â”€ Launch Q4 2025
```

### **Target Market**
1. **Primary:** Addiction recovery (alcohol, drugs, gambling)
2. **Secondary:** Mental health (anxiety, depression, PTSD)
3. **Tertiary:** General peer support

### **Positioning**
"Your complete recovery support system - AI when you need it, humans when you want it"

---

## Feature Specifications

### **1. Harthio AI Companion** ğŸ’¬
**What:** Conversational AI for 24/7 mental health support

**Capabilities:**
- Natural conversation about struggles
- Evidence-based CBT techniques
- Crisis detection & resources
- Smart session suggestions
- Recovery progress tracking

**Access:**
- Free: âŒ Not available
- Pro: âœ… Unlimited chat

**Example Conversation:**
```
User: "I'm having cravings tonight"

Harthio: "I'm here for you. Let's work through this:

1. ğŸ§  Challenge those thoughts (CBT)
2. ğŸ’ª Quick coping technique
3. ğŸ¯ Find support session
4. ğŸ“ Crisis resources

What would help most right now?"
```

---

### **2. AI Topic Helper** âœ¨
**What:** Helps users create better session topics

**How It Works:**
```
User: "struggling with staying sober at night"

Harthio: "I can help you create a session:

Title: Evening Sobriety Support
Description: Let's discuss strategies for staying 
sober during difficult evening hours. Share what 
works and learn from others.

[âœï¸ Edit] [âœ“ Create] [ğŸ”„ Try Again]"
```

**Access:**
- Free: 1 per day
- Pro: 10 per day

**Why Limited?**
- Prevents session spam
- Encourages thoughtful creation
- Keeps costs predictable

---

### **3. Contextual Daily Check-In** ğŸ“Š
**What:** Mood tracking with optional context capture

**New Flow (Implemented):**
```
User clicks: ğŸ˜Š Good

[Slide-down animation from top]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ That's great! ğŸ‰                   â”‚
â”‚ What made you feel good today?      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [Optional text input...]        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [Skip] [Save]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[Slides up after save/skip]
```

**Smart Prompts Based on Mood:**
- ğŸ˜¢ Struggling: "What's making today tough? Want to talk?"
- ğŸ˜ Okay: "Anything on your mind today?"
- ğŸ˜Š Good: "What made you feel good today?"
- ğŸš€ Great: "That's amazing! What's going well?"

**Auto-Response for Crisis:**
```
User clicks: ğŸ˜¢ Struggling (3 days in a row)

Immediate actions:
ğŸ—£ï¸ Talk to Harthio AI
ğŸ“… Find support session
ğŸ“ Crisis resources
â­ï¸ Skip for now
```

**Access:**
- Free: âœ… Unlimited check-ins
- Pro: âœ… Unlimited + AI analysis of patterns

**Why This Matters:**
- Captures context, not just numbers
- Builds data for AI pattern detection
- Encourages reflection without pressure
- Optional (can skip)
- Crisis intervention at critical moments

---

### **4. CBT Tools Suite** ğŸ§ 
**What:** Evidence-based mental health techniques integrated into Harthio AI

**Tools (All Grade A/B Clinical Evidence):**
1. **ğŸ§  Thought Challenger** - Cognitive restructuring (Aaron Beck's CBT)
2. **ğŸŒŠ 4-4-6 Breathing** - Anxiety/panic relief (neuroscience validated)
3. **ğŸ¯ 5-4-3-2-1 Grounding** - Sensory awareness (DBT standard)
4. **ğŸ’ª Coping Techniques** - Cold water, PMR, visualization, movement

**Clinical Protocol:**
Validate â†’ Normalize â†’ Educate â†’ Offer â†’ Guide â†’ Check-in â†’ Escalate if needed

**Professional Standards:**
- One-time disclaimer (positively framed)
- Crisis escalation protocols
- Never diagnose/prescribe
- Matches Headspace/Calm standards

**Access:**
- Free: âŒ Not available
- Pro: âœ… Unlimited ($9.99/month vs competitors $70+/year)

---

### **5. Real-Time Sobriety Tracker** â±ï¸
**What:** Live countdown of recovery milestones with visual journey gamification

**Real-Time Counter:**
- Updates every second: Months, Days, Hours, Minutes, Seconds
- Multiple trackers: Alcohol, Smoking, Drugs, Gambling, Other
- Swipeable cards for multiple recovery goals
- Color-coded by type

**Visual Journey Gamification (30-Piece System):**
- **Phase 1 (Days 0-90): Building the Bridge** ğŸŒ‰
  - 30 pieces total, 1 piece unlocks every 3 days
  - Complete bridge = 90-day milestone
  
- **Phase 2 (Days 91-180): Phoenix Rising** ğŸ”¥
  - New 30-piece image starts
  - 1 piece every 3 days
  - Complete phoenix = 6-month milestone
  
- **Phase 3 (Days 181-365): Climbing the Mountain** â›°ï¸
  - New 30-piece image starts
  - 1 piece every 6 days (sl

**AI-Powered Management:**
```
Tracker Creation (via AI):
User: "I want to track my alcohol sobriety"
Harthio: "Great! When did you start? Today or a different date?"
User: "Started 3 days ago"
Harthio: "Done! Your 'Alcohol Free' tracker is live. 
You're 3 days strong! ğŸ’ª"

Tracker Reset (AI-Guarded):
User: "I need to reset my tracker"
Harthio: "I'm here for you. Can you tell me what happened?
You were 45 days strong - that's incredible progress.

Would you like to:
1. ğŸ—£ï¸ Talk about what led to this
2. ğŸ“ Connect with someone
3. ğŸ”„ Reset counter and start fresh
4. â¸ï¸ Take a moment before deciding"
```

**Why AI-Guarded Reset:**
- âœ… Crisis intervention moment
- âœ… Prevents impulsive decisions
- âœ… Offers immediate support
- âœ… Reduces shame around setbacks
- âœ… Connects to help resources
- âœ… Learns relapse triggers

**Access:**
- Free: âœ… Unlimited trackers with real-time counting
- Pro: âœ… Advanced analytics + AI pattern detection

**Security:**
- Row Level Security (RLS) enabled
- Users can only see/modify their own trackers
- Data encrypted and private

---

## Pricing Model

### **Strategic Approach: Smart Freemium with Data Collection**

**Philosophy:** Free users provide valuable data (mood patterns, recovery data, session feedback) that helps improve AI. In return, they get limited but meaningful features. This creates a win-win: we learn, they get value, and they see what Pro offers.

### **Free Tier - Limited Access (Data Collection Strategy)**
```
âœ… Unlimited peer sessions
âœ… Unlimited daily check-ins (mood tracking)
âœ… 1 basic sobriety tracker (days only, no visual journey)
âœ… 3 AI messages per day (post-session support)
âœ… Crisis resources (always unlimited)
âœ… Basic breathing exercises

âŒ No unlimited AI companion
âŒ No CBT tools (Thought Challenger, Grounding)
âŒ No visual journey (image reveals)
âŒ No real-time counter (seconds)
âŒ No pattern detection
âŒ No advanced analytics
âŒ Limited to 1 tracker
```

**What Free Users Provide:**
- Mood pattern data (daily check-ins)
- Recovery data (basic tracker)
- Session feedback (post-session)
- AI conversation samples (3/day)
- Feature usage patterns
- Conversion funnel insights

**Free Tier Limits Explained:**

1. **Sobriety Tracker (1 Basic Tracker)**
   - Days counter only (no real-time seconds)
   - No visual journey (no image reveals)
   - Basic milestones only (1 day, 1 week, 1 month)
   - Single tracker (not unlimited)
   - Why: Shows value, collects recovery data, encourages upgrade

2. **AI Chat (3 Messages/Day)**
   - Basic emotional support
   - Crisis resources (unlimited)
   - Simple breathing exercises
   - Post-session reflection (basic)
   - Why: Let users try AI, collect conversation data, prevent abuse

3. **Daily Check-ins (Unlimited)**
   - All mood tracking features
   - Optional notes/context
   - Why: Core mental health feature, builds engagement, collects mood data

### **Pro Tier - $9.99/month (Full Access)**
```
âœ… Everything in Free, plus:

ğŸ¤– AI Features:
âœ… Unlimited AI companion (24/7 support)
âœ… Full CBT tools suite (Thought Challenger, Grounding, etc.)
âœ… Pattern detection ("You struggle on Mondays")
âœ… Mood insights & analytics

ğŸ“Š Recovery Features:
âœ… Unlimited sobriety trackers
âœ… Real-time counter (months, days, hours, minutes, seconds)
âœ… Visual journey (30-piece image reveals)
âœ… Advanced milestones & badges
âœ… Relapse insights & triggers
âœ… Export recovery data

ğŸ“ˆ Analytics:
âœ… Detailed progress charts
âœ… Trend analysis
âœ… Predictive warnings
âœ… Weekly/monthly reports

ğŸ¯ Priority Access:
âœ… Priority session matching
âœ… Ad-free experience
âœ… Early access to new features
```

### **AI Interaction Model (No Hard Locks)**

**Free User Experience:**
```
User: "I'm feeling anxious"

Harthio AI: "I hear you. Let's take a breath together.

Breathe in for 4... hold for 4... out for 6...

How do you feel now?

ğŸ’™ You have 2 AI messages left today.

Want deeper support? Pro members get:
âœ… Unlimited AI conversations
âœ… Full CBT tools (Thought Challenger, Grounding)
âœ… Pattern detection & insights

[Start 14-Day Free Trial]

What would you like to do?
[ğŸ—£ï¸ Keep Talking] [ğŸŒŠ Breathing Exercise] [ğŸ“ Crisis Resources]"
```

**When Free User Requests Pro Feature:**
```
User clicks: [ğŸ§  Thought Challenger]

Harthio AI: "The Thought Challenger is a powerful CBT tool 
that helps reframe negative thinking. ğŸ§ 

This is a Pro feature. With Pro you get:
âœ… Full CBT tools suite
âœ… Unlimited AI conversations
âœ… Pattern detection
âœ… Advanced recovery tracking

Only $9.99/month - less than a therapy copay!

[Start 14-Day Free Trial] [Learn More About Pro]

For now, I can help with:
âœ… Basic breathing exercises
âœ… Listening & support (3 messages/day)
âœ… Crisis resources

What would help you right now?"
```

**Pro User Experience:**
```
User: "I'm feeling anxious"

Harthio AI: "I'm here for you. Let's work through this together.

What would you like to do?

[ğŸ—£ï¸ Talk About It]        â† Unlimited conversation
[ğŸ§  Thought Challenger]    â† Full CBT tool
[ğŸŒŠ Breathing Exercise]    â† Guided technique
[ğŸ¯ 5-4-3-2-1 Grounding]   â† Sensory awareness
[ğŸ’ª Coping Techniques]     â† Multiple strategies
[ğŸ“Š Update Tracker]        â† Track progress

Or just type what's on your mind..."
```

### **Post-Session Flow (Key Upsell Moment)**

**Free User After Session:**
```
Session ends â†’ Redirect to Harthio AI

Harthio AI: "Hi! How was your session? ğŸ’™

What would you like to do?

[ğŸ—£ï¸ Talk About It]        â† Free (counts toward 3/day)
[ğŸ§  Thought Challenger]    â† Pro only (shows upgrade prompt)
[ğŸŒŠ Breathing Exercise]    â† Free (basic)
[ğŸ“Š Update Tracker]        â† Free (1 basic tracker)
[ğŸ’ª Coping Techniques]     â† Pro only (shows upgrade prompt)

Or just type what's on your mind..."
```

**Pro User After Session:**
```
Session ends â†’ Redirect to Harthio AI

Harthio AI: "Hi! How was your session? ğŸ’™

I'm here to help you process what came up. 
Want to talk about it?

[Start Conversation]

Or try:
ğŸ§  Thought Challenger
ğŸŒŠ Breathing Exercise
ğŸ¯ 5-4-3-2-1 Grounding
ğŸ“Š Update Recovery Tracker
ğŸ’ª Coping Techniques

Full AI support available 24/7."
```

### **Free Trial**
- **14 days** (not 7)
- Full Pro access during trial
- Why? Mental health needs time to show impact
- Allows users to experience full value
- See real progress in recovery
- Higher conversion after experiencing Pro features

### **Revenue Projections**
```
Current (v0.2): 40 users Ã— 0% = $0/month
v0.3 Launch: 500 users Ã— 10% = $500/month
  - 450 free users (data collection)
  - 50 Pro users ($500 revenue)
  - AI costs: ~$100/month (3 msg/day Ã— 450 users)
  - Net: $400/month profit

v0.4 (therapy): Additional commission revenue
  - Therapist referrals
  - Insurance integration
```

### **Cost Analysis**

**Free User AI Costs:**
- 3 messages/day Ã— $0.015/message = $0.045/day
- $0.045/day Ã— 30 days = $1.35/month per free user
- 450 free users Ã— $1.35 = $607.50/month AI costs

**Break-Even Math:**
- Need 61 Pro users to cover free user AI costs ($607.50 Ã· $9.99)
- At 10% conversion: 500 users â†’ 50 Pro users = $500/month
- Slightly under break-even, but acceptable for growth phase
- At 15% conversion: 500 users â†’ 75 Pro users = $750/month (profitable)

**Why This Works:**
- Free users provide valuable data
- Limited access shows value without breaking bank
- Clear upgrade path at critical moments (post-session)
- Ethical (crisis support always free)
- Sustainable (costs controlled)
- Conversion-optimized (users see what they're missing)

---

## Responsive Design Strategy

### **Screen Sizes**
```
Mobile:  < 768px  (sm)  - Bottom navigation (4 tabs)
Tablet:  768-1024px (md) - Sidebar navigation
Desktop: > 1024px (lg)   - Sidebar navigation
```

### **Mobile (< 768px) - Bottom Navigation**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ       ğŸ’¬        ğŸ“…        ğŸ“Š        ğŸ‘¤         â”‚
â”‚ Home  Harthio  Sessions  Progress    Me          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Fixed bottom bar (5 tabs)
- Content has `pb-16` padding to avoid overlap
- Compact icons for mobile

### **Tablet/Desktop (â‰¥ 768px) - Sidebar Navigation**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sidebar  â”‚  Main Content          â”‚
â”‚          â”‚                        â”‚
â”‚ Home     â”‚  Dashboard/Page        â”‚
â”‚ Harthio  â”‚                        â”‚
â”‚ Sessions â”‚                        â”‚
â”‚ Progress â”‚                        â”‚
â”‚ Requests â”‚                        â”‚
â”‚ Profile  â”‚                        â”‚
â”‚ History  â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Sidebar shows all navigation
- No bottom bar
- Full screen content

### **Implementation Status**
- âœ… Mobile bottom nav (5 tabs) - COMPLETED
- âœ… Responsive design (mobile + desktop) - COMPLETED
- âœ… Tab order: Progress | Harthio | Home | Sessions | Me - COMPLETED
- âœ… Home page with daily quotes - COMPLETED
- âœ… Daily check-in functionality - COMPLETED
- âœ… Progress page structure - COMPLETED
- âš ï¸ Need to implement: Recovery tracker visualization
- âš ï¸ Need to implement: Harthio AI chat
- âš ï¸ Need to implement: Real data integration

### **Tab 1: ğŸ“Š Progress** (First Position)
**Status: âœ… COMPLETED (Tracker & History), âš ï¸ Stats Pending**
- âœ… Recovery tracker with 7-day mood chart
- âœ… Weekly insights (trend, best/worst days)
- âœ… Session history with real data
- âœ… Quick stats cards (Current Streak, Total Check-ins, Sessions Joined)
- âœ… 3-tab layout: Tracker | History | Stats
- âš ï¸ Weekly stats - Placeholder ready

### **Tab 2: ğŸ’¬ Harthio** (AI Companion)
**Status: âš ï¸ Not Started**
- Conversational AI interface
- CBT tools
- Crisis resources
- Pro-only access check
- Voice input option (future)

### **Tab 3: ğŸ  Home** (Default Landing - Center Position)
**Status: âœ… REDESIGNED - Recovery-Focused**

**New Design Philosophy:**
- Focus on recovery outcomes (sobriety days), not perfection (streaks)
- Clean, uncluttered, encouraging
- Every interaction offers support
- AI-integrated for intelligent responses

**Features:**
- âœ… **Real-time sobriety counter** (main focus)
  - Counts months, days, hours, minutes, seconds
  - Updates every second
  - Swipeable for multiple trackers
  - Milestone badges (1 day, 1 week, 1 month, 90 days, 1 year)
  - Background visuals (Bridge/Phoenix/Mountain) - coming

- âœ… **Contextual mood check-in**
  - 4 mood buttons (ğŸ˜¢ Struggling, ğŸ˜ Okay, ğŸ˜Š Good, ğŸš€ Great)
  - Slide-down prompt for optional note
  - Smart prompts based on mood selected
  - Crisis intervention for "Struggling" patterns
  - Last check-in indicator

- âœ… **Simplified motivational quote**
  - 5 short, impactful quotes
  - Rotates daily
  - Small, non-intrusive

**Removed (Intentionally):**
- âŒ Check-in streaks - Too stressful, punishes missed days
- âŒ Sessions joined stat - Belongs in Progress page
- âŒ Manual tracker creation - AI handles this
- âŒ Reset button - AI-guarded for safety
- âŒ Quick action buttons - Reduces clutter

**Why This Works:**
- Focuses on what matters: sobriety time
- Removes pressure and guilt
- Encourages without demanding
- Supports at critical moments
- Clean, peaceful interface

### **Tab 4: ğŸ“… Sessions** (Current Dashboard)
**Status: âœ… Already Exists**
- Browse live & upcoming sessions
- Create new session
- Request to join
- Search & filter
- Real-time updates

### **Tab 5: ğŸ‘¤ Me** (Profile)
**Status: âœ… Already Exists**
- Profile & settings
- Notifications
- Upgrade to Pro (placeholder)
- Help & support

---

## Crisis Detection System

### **Comprehensive Keywords (60+)**

**Critical (Immediate Danger):**
- Suicide, kill myself, end it all, overdose
- Jump off, hang myself, gun to my head
- Hurt my child, harm my baby

**High (Serious Concern):**
- Self harm, cutting, hurt myself
- Using again, bought drugs, going to use
- Voices telling me, hallucinating

**Moderate (Elevated Risk):**
- No hope, hopeless, can't go on
- Panic attack, can't breathe
- Giving up, why bother

### **Response System**

**Critical:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ†˜ We're Concerned About You       â”‚
â”‚                                     â”‚
â”‚  ğŸ“ 988 Suicide & Crisis Lifeline   â”‚
â”‚      [Call Now]                     â”‚
â”‚                                     â”‚
â”‚  ğŸ“± Text HOME to 741741             â”‚
â”‚      [Open Messages]                â”‚
â”‚                                     â”‚
â”‚  ğŸš¨ Emergency: 911                  â”‚
â”‚      [Call Now]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Logging:**
- All crisis events logged
- Admin dashboard for review
- Severity levels tracked
- Future: Real-time admin alerts

---

## Implementation Timeline

### **Week 1-2: Planning & Design**
- [x] Strategic planning
- [x] Feature decisions
- [x] 5-tab navigation structure
- [x] User flows
- [x] Database schema for check-ins

### **Week 3-4: UI Redesign** âœ… COMPLETED
- [x] 5-tab bottom navigation (Progress | Harthio | Home | Sessions | Me)
- [x] Home page with daily quotes
- [x] Progress page structure
- [x] Mobile responsive testing
- [x] Recovery tracker visualization with charts
- [x] Real data integration

### **Week 5-6: Core Features & Data Integration** âœ… COMPLETED
- [x] Daily check-ins (functional)
- [x] Connect real session history to Progress page
- [x] Recovery tracker with real data
- [x] Check-in streak calculation (removed - too stressful)
- [x] Weekly stats implementation
- [x] Real-time sobriety counter
- [x] Multiple tracker support
- [x] Contextual check-in design
- [x] Security hardening (all APIs)

### **Week 7-8: AI Integration** â† WE ARE HERE
- [ ] DeepSeek API setup
- [ ] Harthio AI chat interface (core feature)
- [ ] Contextual check-in with slide-down note input
- [ ] AI-powered tracker creation
- [ ] AI-guarded tracker reset (crisis intervention)
- [ ] Pattern detection & proactive support
- [ ] Rate limiting system (Pro tier)
- [ ] Cost monitoring

### **Week 7-8: AI Integration**
- [ ] DeepSeek API setup
- [ ] Harthio AI chat interface
- [ ] Rate limiting system (1/day free, 10/day pro)
- [ ] Cost monitoring
- [ ] Crisis detection integration

### **Week 9-10: Testing**
- [ ] Beta with 10 users
- [ ] Bug fixes
- [ ] Performance optimization
- [ ] Security review

### **Week 11-12: Launch**
- [ ] Deploy to production
- [ ] Announce to 40 users
- [ ] Monitor & iterate
- [ ] Marketing campaign

---

## Success Metrics

### **Activation**
- âœ… 80% try Harthio AI
- âœ… 50% use weekly
- âœ… 3 interactions/user/week

### **Engagement**
- âœ… 60% daily check-ins
- âœ… 40% use CBT tools
- âœ… 70% view tracker

### **Conversion**
- âœ… 10% convert to Pro
- âœ… 50 Pro users = $500/month
- âœ… <$100/month AI costs

### **Growth**
- âœ… 500 users by end Q1
- âœ… 12.5x from current 40
- âœ… 30% month-over-month

### **Recovery Outcomes** ğŸ’™
- âœ… Users feel supported
- âœ… Crisis interventions work
- âœ… Sobriety days increasing
- âœ… Lives positively impacted

---

## Technical Stack

**Frontend:**
- Next.js 14 (current)
- React Native (mobile apps)
- Tailwind CSS
- Mobile-first responsive

**Backend:**
- Supabase (PostgreSQL)
- DeepSeek API (AI)
- Real-time subscriptions
- WebRTC (video)

**AI Infrastructure:**
- DeepSeek V2 API only
- Rate limiting (1/day free, 10/day pro for topic helper)
- Response caching (1 hour)
- Budget cap: $5/day

---

## Safety & Compliance

### **Age Verification**
- Required for addiction features
- 18+ for addiction recovery
- 13+ for general mental health (with consent)
- Collect date of birth

### **Data Privacy**
- Encrypt all AI conversations
- Users can delete history
- No AI training on user data
- HIPAA-aware (not compliant yet)

### **Crisis Logging**
- All events logged for admin
- Severity levels tracked
- Admin dashboard review
- Future: Real-time alerts

---

## AI Integration Architecture

### **Contextual Check-In Flow**
```
User clicks mood â†’ 
  Slide-down animation (0.3s) â†’
  Smart prompt based on mood â†’
  Optional text input â†’
  Save mood + note â†’
  AI analyzes for patterns â†’
  Slide up animation
```

### **Crisis Detection & Intervention**
```
Struggling mood 3 days in a row â†’
  AI proactively reaches out â†’
  "I noticed you've been struggling. Want to talk?" â†’
  Offers: Talk to AI | Find session | Crisis resources
```

### **AI-Guarded Actions**
```
Critical actions (tracker reset, account deletion) â†’
  Redirect to Harthio AI â†’
  Conversation-based intervention â†’
  Support options offered â†’
  Action only after conversation
```

### **Pattern Detection**
```
AI has access to:
- Check-in history + notes
- Sobriety tracker data
- Mood patterns
- Session participation
- Crisis keywords

AI can:
- Detect patterns ("You feel struggling every Monday")
- Suggest interventions ("Want to schedule a Monday session?")
- Celebrate wins ("30 days! Remember when you said...")
- Provide context-aware support
```

---

## Next Immediate Actions

1. âœ… **Home page redesign** - COMPLETED
2. âœ… **Progress page with stats** - COMPLETED
3. âœ… **Security hardening** - COMPLETED
4. â³ **Contextual check-in UI** - NEXT
5. â³ **Harthio AI chat interface** - CORE FEATURE
6. â³ **AI-powered features** - Integration
7. â³ **Crisis detection system** - Safety critical

---

**Status:** âœ… Week 5-6 complete! Moving to AI integration phase.

**Remember:** We're building a recovery platform that saves lives. Every feature serves that mission. Every interaction offers support. No cold features - everything is human-centered and compassionate.
